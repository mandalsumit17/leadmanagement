<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LeadConnect AI - Intelligent Lead Prioritization</title>
    <link rel="stylesheet" href="style.css">
    <!-- Chart.js CDN for analytics charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">LC</div>
                    <div class="logo-text">
                        
                        <h1>LeadConnect AI</h1>
                        <span>Lead Prioritization</span>
                    </div>
                </div>
            </div>
            <nav class="sidebar-nav">
                <ul>
                    <li class="nav-item active">
                        <a href="#" class="nav-link" data-target="allLeadsView">
                            <span class="nav-icon">üë•</span>
                            All Leads
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-target="hotLeadsView">
                            <span class="nav-icon">‚ö°</span>
                            Hot Leads
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-target="analyticsView">
                            <span class="nav-icon">üìà</span>
                            Analytics
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-target="settingsView">
                            <span class="nav-icon">‚öôÔ∏è</span>
                            Settings
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-target="importLeadsView">
                            <span class="nav-icon">‚¨ÜÔ∏è</span>
                            Import Leads
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Alerts/Notifications -->
            <div id="alertBar" class="alert-bar" style="display:none;"></div>
            <!-- All Leads View -->
            <div id="allLeadsView" class="content-view active">
                <!-- Header -->
                <header class="dashboard-header">
                    <div class="header-left">
                        <h1>Lead Prioritization Dashboard</h1>
                        <p>AI-powered lead scoring and recommendations</p>
                    </div>
                    <div class="header-right">
                        <div class="user-info">
                            <div class="user-avatar">JS</div>
                            <div class="user-details">
                                <span class="user-name">John Smith</span>
                                <span class="user-role">Sales Manager</span>
                            </div>
                        </div>
                    </div>
                </header>

                <!-- Filters and Controls -->
                <section class="filters-section">
                    <div class="filters-container">
                        <div class="search-container">
                            <input type="text" id="searchInput" class="form-control search-input" placeholder="Search leads or companies...">
                        </div>
                        <div class="filter-controls">
                            <select id="intentFilter" class="form-control filter-select">
                                <option value="">All Intent Scores</option>
                                <option value="high">High (85-100%)</option>
                                <option value="warm">Warm (60-84%)</option>
                                <option value="cold">Cold (<60%)</option>
                            </select>
                            <select id="industryFilter" class="form-control filter-select">
                                <option value="">All Industries</option>
                                <option value="Technology">Technology</option>
                                <option value="Healthcare">Healthcare</option>
                                <option value="Finance">Finance</option>
                                <option value="Manufacturing">Manufacturing</option>
                                <option value="Education">Education</option>
                                <option value="Retail">Retail</option>
                                <option value="Energy">Energy</option>
                            </select>
                            <select id="sizeFilter" class="form-control filter-select">
                                <option value="">All Company Sizes</option>
                                <option value="Enterprise">Enterprise</option>
                                <option value="Mid-Market">Mid-Market</option>
                                <option value="Small Business">Small Business</option>
                            </select>
                        </div>
                    </div>
                </section>

                <!-- Lead List -->
                <section class="leads-section">
                    <div class="leads-header">
                        <h2>Prioritized Leads (<span id="leadCount">0</span>)</h2>
                        <div class="view-controls">
                            <button class="view-btn active" data-view="card">Card View</button>
                            <button class="view-btn" data-view="list">List View</button>
                        </div>
                    </div>
                    <div id="leadsContainer" class="leads-container">
                        <!-- Leads will be dynamically rendered here -->
                    </div>
                </section>
            </div>

            <!-- Hot Leads View -->
            <div id="hotLeadsView" class="content-view hidden">
                <header class="dashboard-header">
                    <div class="header-left">
                        <h1>Hot Leads Dashboard</h1>
                        <p>High-intent leads requiring immediate attention</p>
                    </div>
                    <div class="header-right">
                        <div class="user-info">
                            <div class="user-avatar">JS</div>
                            <div class="user-details">
                                <span class="user-name">John Smith</span>
                                <span class="user-role">Sales Manager</span>
                            </div>
                        </div>
                    </div>
                </header>

                <section class="filters-section">
                    <div class="filters-container">
                        <div class="search-container">
                            <input type="text" id="hotSearchInput" class="form-control search-input" placeholder="Search hot leads...">
                        </div>
                        <div class="filter-controls">
                            <select id="hotIndustryFilter" class="form-control filter-select">
                                <option value="">All Industries</option>
                                <option value="Technology">Technology</option>
                                <option value="Healthcare">Healthcare</option>
                                <option value="Finance">Finance</option>
                                <option value="Manufacturing">Manufacturing</option>
                                <option value="Education">Education</option>
                                <option value="Retail">Retail</option>
                                <option value="Energy">Energy</option>
                            </select>
                            <select id="hotSizeFilter" class="form-control filter-select">
                                <option value="">All Company Sizes</option>
                                <option value="Enterprise">Enterprise</option>
                                <option value="Mid-Market">Mid-Market</option>
                                <option value="Small Business">Small Business</option>
                            </select>
                        </div>
                    </div>
                </section>

                <section class="leads-section">
                    <div class="leads-header">
                        <h2>Hot Leads (<span id="hotLeadCount">0</span>)</h2>
                    </div>
                    <div id="hotLeadsContainer" class="leads-container">
                        <!-- Hot leads will be dynamically rendered here -->
                    </div>
                </section>
            </div>

            <!-- Analytics View -->
            <div id="analyticsView" class="content-view hidden">
                <div style="padding: var(--space-32);">
                    <h2 style="font-size: var(--font-size-3xl); font-weight: var(--font-weight-semibold); margin-bottom: var(--space-24);">Analytics Dashboard</h2>
                    <!-- KPI Cards -->
                    <div class="kpi-cards" style="display: flex; gap: 24px; margin-bottom: 32px; flex-wrap: wrap;">
                        <div class="kpi-card">
                            <div class="kpi-label">Conversion Rate</div>
                            <div class="kpi-value" id="kpiConversionRate">--%</div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-label">Pipeline Velocity</div>
                            <div class="kpi-value" id="kpiPipelineVelocity">--</div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-label">SDR Performance</div>
                            <div class="kpi-value" id="kpiSDRPerformance">--</div>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: var(--space-24);">
                        <div class="card">
                            <div class="card__body">
                                <!-- Chart.js will render here -->
                            </div>
                        </div>
                        <div class="card">
                            <div class="card__body">
                                <!-- Chart.js will render here -->
                            </div>
                        </div>
                        <div class="card">
                            <div class="card__body">
                                <!-- Chart.js will render here -->
                            </div>
                        </div>
                    </div>
                    <!-- Custom Reports Section -->
                    <div class="card" style="margin-top:32px;">
                        <div class="card__body">
                            <h3 style="font-size: var(--font-size-lg); font-weight: var(--font-weight-medium); margin-bottom: var(--space-16);">Custom Reports & Export</h3>
                            <form id="customReportForm" style="display:flex;gap:16px;flex-wrap:wrap;align-items:center;">
                                <label><input type="checkbox" name="fields" value="contact" checked> Contact</label>
                                <label><input type="checkbox" name="fields" value="company" checked> Company</label>
                                <label><input type="checkbox" name="fields" value="title" checked> Title</label>
                                <label><input type="checkbox" name="fields" value="industry"> Industry</label>
                                <label><input type="checkbox" name="fields" value="companySize"> Company Size</label>
                                <label><input type="checkbox" name="fields" value="intentScore"> Intent Score</label>
                                <label><input type="checkbox" name="fields" value="email"> Email</label>
                                <label><input type="checkbox" name="fields" value="website"> Website</label>
                                <button type="submit" class="btn btn--primary">Export CSV</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings View -->
            <div id="settingsView" class="content-view hidden">
                <div style="padding: var(--space-32);">
                    <h2 style="font-size: var(--font-size-3xl); font-weight: var(--font-weight-semibold); margin-bottom: var(--space-24);">Account Settings</h2>
                    <div class="card" style="margin-bottom: var(--space-24);">
                        <div class="card__body">
                            <h3 style="font-size: var(--font-size-lg); font-weight: var(--font-weight-medium); margin-bottom: var(--space-16);">Profile Information</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--space-16);">
                                <div class="form-group">
                                    <label for="name" class="form-label">Name</label>
                                    <input type="text" id="name" class="form-control" value="John Smith">
                                </div>
                                <div class="form-group">
                                    <label for="email" class="form-label">Email</label>
                                    <input type="email" id="email" class="form-control" value="john.smith@example.com">
                                </div>
                            </div>
                            <button class="btn btn--primary" style="margin-top: var(--space-16);">Save Profile</button>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card__body">
                            <h3 style="font-size: var(--font-size-lg); font-weight: var(--font-weight-medium); margin-bottom: var(--space-16);">Notification Preferences</h3>
                            <div style="display: flex; flex-direction: column; gap: var(--space-8);">
                                <div style="display: flex; align-items: center; gap: var(--space-8);">
                                    <input type="checkbox" id="email-notifications" style="margin: 0;">
                                    <label for="email-notifications" style="color: var(--color-text); margin: 0;">Email Notifications</label>
                                </div>
                                <div style="display: flex; align-items: center; gap: var(--space-8);">
                                    <input type="checkbox" id="inapp-notifications" checked style="margin: 0;">
                                    <label for="inapp-notifications" style="color: var(--color-text); margin: 0;">In-App Notifications</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Import Leads View -->
            <div id="importLeadsView" class="content-view hidden">
                <div style="padding: var(--space-32); max-width: 600px; margin: auto;">
                    <h2 style="font-size: var(--font-size-3xl); font-weight: var(--font-weight-semibold); margin-bottom: var(--space-24);">Import Leads</h2>
                    <form id="importForm">
                        <div class="card" style="margin-bottom: var(--space-24);">
                            <div class="card__body">
                                <label for="leadsFile" class="form-label">Upload CSV File</label>
                                <input type="file" id="leadsFile" accept=".csv" class="form-control" required>
                            </div>
                        </div>
                        <div id="mappingSection" class="card hidden" style="margin-bottom: var(--space-24);">
                            <div class="card__body">
                                <h3 style="font-size: var(--font-size-lg); font-weight: var(--font-weight-medium); margin-bottom: var(--space-16);">Map Columns</h3>
                                <div id="mappingFields"></div>
                            </div>
                        </div>
                        <button type="submit" class="btn btn--primary hidden" id="submitImportBtn">Import Leads</button>
                    </form>
                    <div id="importStatus" style="margin-top: var(--space-16);"></div>
                </div>
            </div>
        </main>
    </div>

    <!-- Reasoning Modal -->
    <div id="reasoningModal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>Lead Score Reasoning</h3>
                <button class="modal-close" id="closeModal">√ó</button>
            </div>
            <div class="modal-body">
                <div class="reasoning-lead-info">
                    <div class="reasoning-avatar" id="reasoningAvatar"></div>
                    <div class="reasoning-details">
                        <h4 id="reasoningLeadName"></h4>
                        <p id="reasoningCompany"></p>
                    </div>
                    <div class="reasoning-score">
                        <div class="score-value" id="reasoningScore"></div>
                        <div class="score-label">Intent Score</div>
                    </div>
                </div>
                <div class="reasoning-content">
                    <h5>Why this score?</h5>
                    <p id="reasoningText"></p>
                    <div class="key-factors">
                        <h6>Key Factors:</h6>
                        <ul id="reasoningInsights"></ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
    <script src="chatbot.js"></script>
    <script>
    // Alert bar logic (simple placeholder, real logic in app.js)
    window.showAlert = function(msg, type = 'info') {
        const bar = document.getElementById('alertBar');
        if (!bar) return;
        bar.textContent = msg;
        bar.style.display = 'block';
        bar.style.background = type === 'error' ? '#db4545' : (type === 'success' ? '#1fb8cd' : '#ffc185');
        bar.style.color = '#fff';
        setTimeout(() => { bar.style.display = 'none'; }, 5000);
    };

    // --- Auto Mapping for Import Leads ---
    document.addEventListener('DOMContentLoaded', function() {
      // Custom Report Export
      var form = document.getElementById('customReportForm');
      if (form) {
        form.addEventListener('submit', function(e) {
          e.preventDefault();
          var checked = Array.from(form.querySelectorAll('input[type="checkbox"][name="fields"]:checked')).map(cb => cb.value);
          if (!checked.length) {
            window.showAlert('Please select at least one field to export.', 'error');
            return;
          }
          var leads = window.filteredLeads || window.leadsData || [];
          if (!leads.length) {
            window.showAlert('No leads to export.', 'error');
            return;
          }
          var csv = '';
          csv += checked.join(',') + '\n';
          leads.forEach(function(lead) {
            var row = checked.map(f => {
              var val = lead[f] !== undefined ? lead[f] : '';
              // Escape quotes and commas
              if (typeof val === 'string' && (val.includes(',') || val.includes('"'))) {
                val = '"' + val.replace(/"/g, '""') + '"';
              }
              return val;
            });
            csv += row.join(',') + '\n';
          });
          var blob = new Blob([csv], {type: 'text/csv'});
          var url = URL.createObjectURL(blob);
          var a = document.createElement('a');
          a.href = url;
          a.download = 'leadconnect_report.csv';
          document.body.appendChild(a);
          a.click();
          setTimeout(function() {
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
          }, 100);
          window.showAlert('Report exported!', 'success');
        });
      }

      // --- Import Leads Auto Mapping ---
      var leadsFileInput = document.getElementById('leadsFile');
      var mappingSection = document.getElementById('mappingSection');
      var mappingFields = document.getElementById('mappingFields');
      var submitImportBtn = document.getElementById('submitImportBtn');
      var importForm = document.getElementById('importForm');

      // Expected fields for mapping
      var expectedFields = [
        { key: 'contact', label: 'Contact', variations: ['contact', 'name', 'full name'] },
        { key: 'company', label: 'Company', variations: ['company', 'organization', 'business'] },
        { key: 'title', label: 'Title', variations: ['title', 'job title', 'designation'] },
        { key: 'industry', label: 'Industry', variations: ['industry', 'sector'] },
        { key: 'companySize', label: 'Company Size', variations: ['company size', 'size', 'employees'] },
        { key: 'intentScore', label: 'Page Views', variations: ['page views'] },
        { key: 'email', label: 'Email', variations: ['email', 'email address'] },
        { key: 'website', label: 'Website', variations: ['website', 'url', 'web'] }
      ];

      function normalize(str) {
        return str.trim().toLowerCase().replace(/[_\- ]+/g, ' ');
      }

      function autoMapColumns(csvHeaders) {
        var mapping = {};
        expectedFields.forEach(field => {
          var match = csvHeaders.find(h => field.variations.some(v => normalize(h) === normalize(v)));
          mapping[field.key] = match || '';
        });
        return mapping;
      }

      function renderMappingFields(csvHeaders, mapping) {
        mappingFields.innerHTML = '';
        let allMapped = true;
        expectedFields.forEach(field => {
          var mappedCol = mapping[field.key];
          var isMapped = mappedCol !== '';
          if (!isMapped) allMapped = false;
          var div = document.createElement('div');
          div.className = 'form-group';
          var label = document.createElement('label');
          label.textContent = field.label + ' column:';
          label.setAttribute('for', 'map_' + field.key);
          div.appendChild(label);
          if (isMapped) {
            var input = document.createElement('input');
            input.type = 'text';
            input.className = 'form-control';
            input.value = mappedCol;
            input.disabled = true;
            input.id = 'map_' + field.key;
            div.appendChild(input);
          } else {
            var select = document.createElement('select');
            select.className = 'form-control';
            select.id = 'map_' + field.key;
            var opt = document.createElement('option');
            opt.value = '';
            opt.textContent = '-- Select --';
            select.appendChild(opt);
            csvHeaders.forEach(h => {
              var option = document.createElement('option');
              option.value = h;
              option.textContent = h;
              select.appendChild(option);
            });
            select.addEventListener('change', function() {
              mapping[field.key] = select.value;
              checkAllMapped();
            });
            div.appendChild(select);
          }
          mappingFields.appendChild(div);
        });
        checkAllMapped();
      }

      function checkAllMapped() {
        var allMapped = expectedFields.every(field => {
          var el = document.getElementById('map_' + field.key);
          if (!el) return false;
          if (el.tagName === 'INPUT') return el.value !== '';
          if (el.tagName === 'SELECT') return el.value !== '';
          return false;
        });
        submitImportBtn.classList.toggle('hidden', !allMapped);
      }

      if (leadsFileInput) {
        leadsFileInput.addEventListener('change', function(e) {
          var file = e.target.files[0];
          if (!file) return;
          var reader = new FileReader();
          reader.onload = function(evt) {
            var text = evt.target.result;
            var lines = text.split(/\r?\n/).filter(l => l.trim().length > 0);
            if (!lines.length) {
              window.showAlert('CSV file is empty.', 'error');
              return;
            }
            var headers = lines[0].split(',').map(h => h.trim());
            var mapping = autoMapColumns(headers);
            mappingSection.classList.remove('hidden');
            renderMappingFields(headers, mapping);
          };
          reader.readAsText(file);
        });
      }

      if (importForm) {
        importForm.addEventListener('submit', function(e) {
          // You can add logic here to use the mapping for actual import
          // For now, just show a success message
          window.showAlert('Leads imported successfully!', 'success');
        });
      }
    });
    </script>
</body>
</html>