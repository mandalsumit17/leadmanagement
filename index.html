<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LeadConnect AI - Intelligent Lead Prioritization</title>
    <link rel="stylesheet" href="style.css">
    <!-- Chart.js CDN for analytics charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">LC</div>
                    <div class="logo-text">
                        
                        <h1>LeadConnect AI</h1>
                        <span>Lead Prioritization</span>
                    </div>
                </div>
            </div>
            <nav class="sidebar-nav">
                <ul>
                    <li class="nav-item active">
                        <a href="#" class="nav-link" data-target="allLeadsView">
                            <span class="nav-icon">üë•</span>
                            All Leads
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-target="hotLeadsView">
                            <span class="nav-icon">‚ö°</span>
                            Hot Leads
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-target="analyticsView">
                            <span class="nav-icon">üìà</span>
                            Analytics
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-target="settingsView">
                            <span class="nav-icon">‚öôÔ∏è</span>
                            Settings
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-target="feedbackView">
                            <span class="nav-icon">üí¨</span>
                            Feedback
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-target="importLeadsView">
                            <span class="nav-icon">‚¨ÜÔ∏è</span>
                            Import Leads
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Alerts/Notifications -->
            <div id="alertBar" class="alert-bar" style="display:none;"></div>
            <!-- All Leads View -->
            <div id="allLeadsView" class="content-view active">
                <!-- Header -->
                <header class="dashboard-header">
                    <div class="header-left">
                        <h1>Lead Prioritization Dashboard</h1>
                        <p>AI-powered lead scoring and recommendations</p>
                    </div>
                    <div class="header-right">
                        <div class="user-info">
                            <div class="user-avatar">JS</div>
                            <div class="user-details">
                                <span class="user-name">John Smith</span>
                                <span class="user-role">Sales Manager</span>
                            </div>
                        </div>
                    </div>
                </header>

                <!-- Filters and Controls -->
                <section class="filters-section">
                    <div class="filters-container">
                        <div class="search-container">
                            <input type="text" id="searchInput" class="form-control search-input" placeholder="Search leads or companies...">
                        </div>
                        <div class="filter-controls">
                            <select id="intentFilter" class="form-control filter-select">
                                <option value="">All Intent Scores</option>
                                <option value="high">High (85-100%)</option>
                                <option value="warm">Warm (60-84%)</option>
                                <option value="cold">Cold (<60%)</option>
                            </select>
                            <select id="industryFilter" class="form-control filter-select">
                                <option value="">All Industries</option>
                                <option value="Technology">Technology</option>
                                <option value="Healthcare">Healthcare</option>
                                <option value="Finance">Finance</option>
                                <option value="Manufacturing">Manufacturing</option>
                                <option value="Education">Education</option>
                                <option value="Retail">Retail</option>
                                <option value="Energy">Energy</option>
                            </select>
                            <select id="sizeFilter" class="form-control filter-select">
                                <option value="">All Company Sizes</option>
                                <option value="Enterprise">Enterprise</option>
                                <option value="Mid-Market">Mid-Market</option>
                                <option value="Small Business">Small Business</option>
                            </select>
                        </div>
                    </div>
                </section>

                <!-- Lead List -->
                <section class="leads-section">
                    <div class="leads-header">
                        <h2>Prioritized Leads (<span id="leadCount">0</span>)</h2>
                        <div class="view-controls">
                            <button class="view-btn active" data-view="card">Card View</button>
                            <button class="view-btn" data-view="list">List View</button>
                        </div>
                    </div>
                    <div id="leadsContainer" class="leads-container">
                        <!-- Leads will be dynamically rendered here -->
                    </div>
                </section>
            </div>

            <!-- Hot Leads View -->
            <div id="hotLeadsView" class="content-view hidden">
                <header class="dashboard-header">
                    <div class="header-left">
                        <h1>Hot Leads Dashboard</h1>
                        <p>High-intent leads requiring immediate attention</p>
                    </div>
                    <div class="header-right">
                        <div class="user-info">
                            <div class="user-avatar">JS</div>
                            <div class="user-details">
                                <span class="user-name">John Smith</span>
                                <span class="user-role">Sales Manager</span>
                            </div>
                        </div>
                    </div>
                </header>

                <section class="filters-section">
                    <div class="filters-container">
                        <div class="search-container">
                            <input type="text" id="hotSearchInput" class="form-control search-input" placeholder="Search hot leads...">
                        </div>
                        <div class="filter-controls">
                            <select id="hotIndustryFilter" class="form-control filter-select">
                                <option value="">All Industries</option>
                                <option value="Technology">Technology</option>
                                <option value="Healthcare">Healthcare</option>
                                <option value="Finance">Finance</option>
                                <option value="Manufacturing">Manufacturing</option>
                                <option value="Education">Education</option>
                                <option value="Retail">Retail</option>
                                <option value="Energy">Energy</option>
                            </select>
                            <select id="hotSizeFilter" class="form-control filter-select">
                                <option value="">All Company Sizes</option>
                                <option value="Enterprise">Enterprise</option>
                                <option value="Mid-Market">Mid-Market</option>
                                <option value="Small Business">Small Business</option>
                            </select>
                        </div>
                    </div>
                </section>

                <section class="leads-section">
                    <div class="leads-header">
                        <h2>Hot Leads (<span id="hotLeadCount">0</span>)</h2>
                    </div>
                    <div id="hotLeadsContainer" class="leads-container">
                        <!-- Hot leads will be dynamically rendered here -->
                    </div>
                </section>
            </div>

            <!-- Analytics View -->
            <div id="analyticsView" class="content-view hidden">
                <div style="padding: var(--space-32);">
                    <h2 style="font-size: var(--font-size-3xl); font-weight: var(--font-weight-semibold); margin-bottom: var(--space-24);">Analytics Dashboard</h2>
                    <!-- KPI Cards -->
                    <div class="kpi-cards" style="display: flex; gap: 24px; margin-bottom: 32px; flex-wrap: wrap;">
                        <div class="kpi-card">
                            <div class="kpi-label">Conversion Rate</div>
                            <div class="kpi-value" id="kpiConversionRate">--%</div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-label">Pipeline Velocity</div>
                            <div class="kpi-value" id="kpiPipelineVelocity">--</div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-label">SDR Performance</div>
                            <div class="kpi-value" id="kpiSDRPerformance">--</div>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: var(--space-24);">
                        <div class="card">
                            <div class="card__body">
                                <!-- Chart.js will render here -->
                            </div>
                        </div>
                        <div class="card">
                            <div class="card__body">
                                <!-- Chart.js will render here -->
                            </div>
                        </div>
                        <div class="card">
                            <div class="card__body">
                                <!-- Chart.js will render here -->
                            </div>
                        </div>
                    </div>
                    <!-- Custom Reports Section -->
                    <div class="card" style="margin-top:32px;">
                        <div class="card__body">
                            <h3 style="font-size: var(--font-size-lg); font-weight: var(--font-weight-medium); margin-bottom: var(--space-16);">Custom Reports & Export</h3>
                            <form id="customReportForm" style="display:flex;gap:16px;flex-wrap:wrap;align-items:center;">
                                <label><input type="checkbox" name="fields" value="contact" checked> Contact</label>
                                <label><input type="checkbox" name="fields" value="company" checked> Company</label>
                                <label><input type="checkbox" name="fields" value="title" checked> Title</label>
                                <label><input type="checkbox" name="fields" value="industry"> Industry</label>
                                <label><input type="checkbox" name="fields" value="companySize"> Company Size</label>
                                <label><input type="checkbox" name="fields" value="intentScore"> Intent Score</label>
                                <label><input type="checkbox" name="fields" value="email"> Email</label>
                                <label><input type="checkbox" name="fields" value="website"> Website</label>
                                <button type="submit" class="btn btn--primary">Export CSV</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings View -->
            <div id="settingsView" class="content-view hidden">
                <div style="padding: var(--space-32);">
                    <h2 style="font-size: var(--font-size-3xl); font-weight: var(--font-weight-semibold); margin-bottom: var(--space-24);">Account Settings</h2>
                    <div class="card" style="margin-bottom: var(--space-24);">
                        <div class="card__body">
                            <h3 style="font-size: var(--font-size-lg); font-weight: var(--font-weight-medium); margin-bottom: var(--space-16);">Profile Information</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--space-16);">
                                <div class="form-group">
                                    <label for="name" class="form-label">Name</label>
                                    <input type="text" id="name" class="form-control" value="John Smith">
                                </div>
                                <div class="form-group">
                                    <label for="email" class="form-label">Email</label>
                                    <input type="email" id="email" class="form-control" value="john.smith@example.com">
                                </div>
                            </div>
                            <button class="btn btn--primary" style="margin-top: var(--space-16);">Save Profile</button>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card__body">
                            <h3 style="font-size: var(--font-size-lg); font-weight: var(--font-weight-medium); margin-bottom: var(--space-16);">Notification Preferences</h3>
                            <div style="display: flex; flex-direction: column; gap: var(--space-8);">
                                <div style="display: flex; align-items: center; gap: var(--space-8);">
                                    <input type="checkbox" id="email-notifications" style="margin: 0;">
                                    <label for="email-notifications" style="color: var(--color-text); margin: 0;">Email Notifications</label>
                                </div>
                                <div style="display: flex; align-items: center; gap: var(--space-8);">
                                    <input type="checkbox" id="inapp-notifications" checked style="margin: 0;">
                                    <label for="inapp-notifications" style="color: var(--color-text); margin: 0;">In-App Notifications</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Feedback View -->
            <div id="feedbackView" class="content-view hidden">
                <header class="dashboard-header">
                    <div class="header-left">
                        <h1>Feedback Management Dashboard</h1>
                        <p>Comprehensive feedback analysis and management system</p>
                    </div>
                    <div class="header-right">
                        <div class="user-info">
                            <div class="user-avatar">JS</div>
                            <div class="user-details">
                                <span class="user-name">John Smith</span>
                                <span class="user-role">Sales Manager</span>
                            </div>
                        </div>
                    </div>
                </header>

                <!-- Feedback Statistics Overview -->
                <section class="feedback-stats-section">
                    <div class="feedback-stats-container">
                        <div class="feedback-stat-card">
                            <div class="stat-icon positive">üëç</div>
                            <div class="stat-content">
                                <div class="stat-value" id="positiveFeedbackCount">0</div>
                                <div class="stat-label">Positive Feedback</div>
                            </div>
                        </div>
                        <div class="feedback-stat-card">
                            <div class="stat-icon negative">üëé</div>
                            <div class="stat-content">
                                <div class="stat-value" id="negativeFeedbackCount">0</div>
                                <div class="stat-label">Negative Feedback</div>
                            </div>
                        </div>
                        <div class="feedback-stat-card">
                            <div class="stat-icon total">üí¨</div>
                            <div class="stat-content">
                                <div class="stat-value" id="totalFeedbackCount">0</div>
                                <div class="stat-label">Total Feedback</div>
                            </div>
                        </div>
                        <div class="feedback-stat-card">
                            <div class="stat-icon accuracy">üéØ</div>
                            <div class="stat-content">
                                <div class="stat-value" id="accuracyRate">0%</div>
                                <div class="stat-label">Accuracy Rate</div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Feedback Controls -->
                <section class="feedback-controls-section">
                    <div class="feedback-controls-container">
                        <div class="search-container">
                            <input type="text" id="feedbackSearchInput" class="form-control search-input" placeholder="Search feedback by lead name or comment...">
                        </div>
                        <div class="filter-controls">
                            <select id="feedbackTypeFilter" class="form-control filter-select">
                                <option value="">All Feedback Types</option>
                                <option value="positive">Positive (üëç)</option>
                                <option value="negative">Negative (üëé)</option>
                            </select>
                            <select id="feedbackLeadFilter" class="form-control filter-select">
                                <option value="">All Leads</option>
                            </select>
                            <button id="exportFeedbackBtn" class="btn btn--primary">
                                <span>üì•</span> Export CSV
                            </button>
                        </div>
                    </div>
                </section>

                <!-- Feedback List -->
                <section class="feedback-list-section">
                    <div class="feedback-list-header">
                        <h2>Feedback History (<span id="feedbackListCount">0</span>)</h2>
                        <button id="clearAllFeedbackBtn" class="btn btn--outline">
                            <span>üóëÔ∏è</span> Clear All
                        </button>
                    </div>
                    <div id="feedbackListContainer" class="feedback-list-container">
                        <!-- Feedback items will be dynamically rendered here -->
                    </div>
                </section>
            </div>

            <!-- Import Leads View -->
            <div id="importLeadsView" class="content-view hidden">
                <div style="padding: var(--space-32); max-width: 600px; margin: auto;">
                    <h2 style="font-size: var(--font-size-3xl); font-weight: var(--font-weight-semibold); margin-bottom: var(--space-24);">Import Leads</h2>
                    <form id="importForm">
                        <div class="card" style="margin-bottom: var(--space-24);">
                            <div class="card__body">
                                <label for="leadsFile" class="form-label">Upload CSV File</label>
                                <input type="file" id="leadsFile" accept=".csv" class="form-control" required>
                            </div>
                        </div>
                        <div id="mappingSection" class="card hidden" style="margin-bottom: var(--space-24);">
                            <div class="card__body">
                                <h3 style="font-size: var(--font-size-lg); font-weight: var(--font-weight-medium); margin-bottom: var(--space-16);">Map Columns</h3>
                                <div id="mappingFields"></div>
                            </div>
                        </div>
                        <button type="submit" class="btn btn--primary hidden" id="submitImportBtn">Import Leads</button>
                    </form>
                    <div id="importStatus" style="margin-top: var(--space-16);"></div>
                </div>
            </div>
        </main>
    </div>

    <!-- Reasoning Modal -->
    <div id="reasoningModal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>Lead Score Reasoning</h3>
                <button class="modal-close" id="closeModal">√ó</button>
            </div>
            <div class="modal-body">
                <div class="reasoning-lead-info">
                    <div class="reasoning-avatar" id="reasoningAvatar"></div>
                    <div class="reasoning-details">
                        <h4 id="reasoningLeadName"></h4>
                        <p id="reasoningCompany"></p>
                    </div>
                    <div class="reasoning-score">
                        <div class="score-value" id="reasoningScore"></div>
                        <div class="score-label">Intent Score</div>
                    </div>
                </div>
                <div class="reasoning-content">
                    <h5>Why this score?</h5>
                    <p id="reasoningText"></p>
                    <div class="key-factors">
                        <h6>Key Factors:</h6>
                        <ul id="reasoningInsights"></ul>
                    </div>
                    
                    <!-- Enhanced Feedback Section -->
                    <div class="feedback-section">
                        <h6>Provide Feedback on This Score</h6>
                        <div class="feedback-buttons">
                            <button type="button" class="feedback-btn positive" id="feedbackPositiveBtn" title="Score is accurate">
                                <span class="feedback-icon">üëç</span>
                                <span class="feedback-text">Accurate</span>
                            </button>
                            <button type="button" class="feedback-btn negative" id="feedbackNegativeBtn" title="Score is inaccurate">
                                <span class="feedback-icon">üëé</span>
                                <span class="feedback-text">Inaccurate</span>
                            </button>
                        </div>
                        
                        <div class="feedback-details" id="feedbackDetailsSection" style="display: none;">
                            <div class="form-group">
                                <label for="feedbackComment" class="form-label">Comment (Optional)</label>
                                <textarea 
                                    id="feedbackComment" 
                                    class="form-control" 
                                    rows="3" 
                                    placeholder="Explain why you think this score is accurate or inaccurate..."
                                    maxlength="500"
                                ></textarea>
                                <small class="char-count">0/500 characters</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="suggestedScore" class="form-label">Suggested Score (0-100)</label>
                                <input 
                                    type="number" 
                                    id="suggestedScore" 
                                    class="form-control" 
                                    min="0" 
                                    max="100" 
                                    placeholder="Enter your suggested score"
                                >
                            </div>
                            
                            <div class="feedback-actions">
                                <button type="button" class="btn btn--primary" id="submitFeedbackBtn">
                                    Submit Feedback
                                </button>
                                <button type="button" class="btn btn--outline" id="cancelFeedbackBtn">
                                    Cancel
                                </button>
                            </div>
                        </div>
                        
                        <div class="feedback-success" id="feedbackSuccessMsg" style="display: none;">
                            <div class="success-icon">‚úÖ</div>
                            <div class="success-text">Thank you for your feedback! It helps improve our AI scoring accuracy.</div>
                        </div>
                        
                        <!-- Feedback History for this Lead -->
                        <div class="lead-feedback-history" id="leadFeedbackHistory">
                            <h6>Previous Feedback for this Lead</h6>
                            <div class="feedback-history-list" id="leadFeedbackHistoryList">
                                <!-- Previous feedback will be rendered here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Advanced Feedback Modal -->
    <div id="feedbackModal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content feedback-modal-content">
            <div class="modal-header">
                <h3>Detailed Feedback</h3>
                <button class="modal-close" id="closeFeedbackModal">√ó</button>
            </div>
            <div class="modal-body">
                <div class="feedback-lead-info">
                    <div class="feedback-avatar" id="feedbackAvatar"></div>
                    <div class="feedback-details-info">
                        <h4 id="feedbackLeadName"></h4>
                        <p id="feedbackCompany"></p>
                    </div>
                    <div class="feedback-score-info">
                        <div class="score-value" id="feedbackScore"></div>
                        <div class="score-label">Current Score</div>
                    </div>
                </div>
                
                <div class="feedback-form">
                    <div class="feedback-type-selection">
                        <h5>How accurate is this score?</h5>
                        <div class="feedback-type-buttons">
                            <button type="button" class="feedback-type-btn positive" data-type="positive">
                                <span class="icon">üëç</span>
                                <span class="label">Accurate</span>
                                <small>Score reflects lead quality well</small>
                            </button>
                            <button type="button" class="feedback-type-btn negative" data-type="negative">
                                <span class="icon">üëé</span>
                                <span class="label">Inaccurate</span>
                                <small>Score doesn't match lead quality</small>
                            </button>
                        </div>
                    </div>
                    
                    <div class="feedback-form-fields" id="feedbackFormFields" style="display: none;">
                        <div class="form-group">
                            <label for="detailedComment" class="form-label">Detailed Comments</label>
                            <textarea 
                                id="detailedComment" 
                                class="form-control" 
                                rows="4" 
                                placeholder="Please explain your reasoning in detail..."
                                maxlength="1000"
                            ></textarea>
                            <small class="char-count">0/1000 characters</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="alternativeScore" class="form-label">What should the score be? (0-100)</label>
                            <input 
                                type="range" 
                                id="alternativeScore" 
                                class="score-slider" 
                                min="0" 
                                max="100" 
                                value="50"
                            >
                            <div class="score-display">
                                <span id="scoreDisplay">50</span>%
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Which factors influenced your assessment?</label>
                            <div class="factor-checkboxes">
                                <label class="checkbox-label">
                                    <input type="checkbox" value="engagement"> Website engagement
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" value="company_size"> Company size
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" value="industry"> Industry relevance
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" value="title"> Job title seniority
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" value="timing"> Purchase timing
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" value="other"> Other factors
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="feedback-actions">
                        <button type="button" class="btn btn--primary" id="submitDetailedFeedback" disabled>
                            Submit Detailed Feedback
                        </button>
                        <button type="button" class="btn btn--outline" id="cancelDetailedFeedback">
                            Cancel
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Include the ML model JavaScript -->
    <script src="ml_model.js"></script>
    <script src="app.js"></script>
    <script src="chatbot.js"></script>
    <script>
    // Alert bar logic (simple placeholder, real logic in app.js)
    window.showAlert = function(msg, type = 'info') {
        const bar = document.getElementById('alertBar');
        if (!bar) return;
        bar.textContent = msg;
        bar.style.display = 'block';
        bar.style.background = type === 'error' ? '#db4545' : (type === 'success' ? '#1fb8cd' : '#ffc185');
        bar.style.color = '#fff';
        setTimeout(() => { bar.style.display = 'none'; }, 5000);
    };

    // --- Auto Mapping for Import Leads ---
    document.addEventListener('DOMContentLoaded', function() {
      // Custom Report Export
      var form = document.getElementById('customReportForm');
      if (form) {
        form.addEventListener('submit', function(e) {
          e.preventDefault();
          var checked = Array.from(form.querySelectorAll('input[type="checkbox"][name="fields"]:checked')).map(cb => cb.value);
          if (!checked.length) {
            window.showAlert('Please select at least one field to export.', 'error');
            return;
          }
          var leads = window.filteredLeads || window.leadsData || [];
          if (!leads.length) {
            window.showAlert('No leads to export.', 'error');
            return;
          }
          var csv = '';
          csv += checked.join(',') + '\n';
          leads.forEach(function(lead) {
            var row = checked.map(f => {
              var val = lead[f] !== undefined ? lead[f] : '';
              // Escape quotes and commas
              if (typeof val === 'string' && (val.includes(',') || val.includes('"'))) {
                val = '"' + val.replace(/"/g, '""') + '"';
              }
              return val;
            });
            csv += row.join(',') + '\n';
          });
          var blob = new Blob([csv], {type: 'text/csv'});
          var url = URL.createObjectURL(blob);
          var a = document.createElement('a');
          a.href = url;
          a.download = 'leadconnect_report.csv';
          document.body.appendChild(a);
          a.click();
          setTimeout(function() {
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
          }, 100);
          window.showAlert('Report exported!', 'success');
        });
      }

      // Import functionality is handled in app.js
    });
    </script>
</body>
</html>